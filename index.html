<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2563eb">
    <meta name="description" content="Escanea productos mientras compras - Sistema de autocompra">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Scan Shop">
    
    <title>Scan as You Shop</title>
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="spinner"></div>
        <p class="loading-text">Cargando...</p>
    </div>

    <!-- App Container -->
    <div class="app-container">
        
        <!-- ================================
             PANTALLA PRINCIPAL: MI CARRITO
             ================================ -->
        <div id="cartScreen" class="screen active">
            <!-- Header -->
            <header class="app-header">
                <h1 class="header-title">üõí Mi Carrito</h1>
                <div class="header-subtitle">
                    <span id="itemsCount">0 productos</span> ‚Ä¢ 
                    <span id="totalPrice">0,00 ‚Ç¨</span>
                </div>
            </header>

            <!-- Main Content -->
            <main class="screen-content">
                <!-- Empty State -->
                <div id="emptyCart" class="empty-state">
                    <div class="empty-icon">üõí</div>
                    <h2>Tu carrito est√° vac√≠o</h2>
                    <p>Usa el esc√°ner o la b√∫squeda para a√±adir productos</p>
                </div>

                <!-- Cart Items -->
                <div id="cartItems" class="cart-items" style="display: none;"></div>
            </main>
        </div>

        <!-- ================================
             PANTALLA DE ESCANEO
             ================================ -->
        <div id="scanScreen" class="screen">
            <header class="app-header">
                <button id="closeScanBtn" class="btn-back">‚Üê Volver</button>
                <h1 class="header-title">üì∑ Escanear Producto</h1>
            </header>

            <main class="screen-content">
                <!-- Camera Preview -->
                <div id="cameraContainer" class="camera-container">
                    <video id="cameraPreview" class="camera-preview" autoplay playsinline></video>
                    <div class="scan-overlay">
                        <div class="scan-line"></div>
                        <p class="scan-instruction">Enfoca el c√≥digo de barras</p>
                    </div>
                </div>

                <!-- Manual Input -->
                <div class="manual-input-section">
                    <p class="section-label">O introduce manualmente:</p>
                    <div class="input-group">
                        <input 
                            type="text" 
                            id="manualCodeInput" 
                            class="manual-input" 
                            placeholder="C√≥digo del producto"
                            autocomplete="off"
                        >
                        <button id="addManualCodeBtn" class="btn btn-primary">A√±adir</button>
                    </div>
                </div>

                <!-- Search Results (when scanning/manual input) -->
                <div id="scanResults" class="scan-results" style="display: none;"></div>
            </main>
        </div>

        <!-- ================================
             PANTALLA DE B√öSQUEDA
             ================================ -->
        <div id="searchScreen" class="screen">
            <header class="app-header">
                <button id="closeSearchBtn" class="btn-back">‚Üê Volver</button>
                <h1 class="header-title">üîç Buscar Productos</h1>
            </header>

            <main class="screen-content">
                <!-- Search Inputs -->
                <div class="search-section">
                    <!-- Campo de c√≥digo -->
                    <div class="input-group code-group">
                        <label for="codeSearchInput" class="input-label">üìã C√≥digo (SKU/EAN)</label>
                        <input 
                            type="text" 
                            id="codeSearchInput" 
                            class="search-input code-input" 
                            placeholder="Ej: 013823608 o 1234567890123"
                            autocomplete="off"
                        >
                    </div>
                    
                    <!-- Campo de descripci√≥n -->
                    <div class="input-group description-group">
                        <label for="descriptionSearchInput" class="input-label">üìù Descripci√≥n</label>
                        <input 
                            type="text" 
                            id="descriptionSearchInput" 
                            class="search-input description-input" 
                            placeholder="Ej: monomando lavabo"
                            autocomplete="off"
                        >
                    </div>
                    
                    <!-- Bot√≥n de b√∫squeda -->
                    <button id="searchBtn" class="btn btn-primary btn-lg">üîç Buscar</button>
                </div>

                <!-- Search Results -->
                <div id="searchResults" class="search-results" style="display: none;">
                    <div class="results-header">
                        <h3 id="searchResultsTitle">Resultados</h3>
                        <button id="clearSearchBtn" class="btn-clear">‚úï Limpiar</button>
                    </div>
                    <div id="searchResultsList" class="results-list"></div>
                </div>

                <!-- Empty State -->
                <div id="searchEmpty" class="empty-state">
                    <div class="empty-icon">üîç</div>
                    <p>Busca por c√≥digo o descripci√≥n</p>
                </div>
            </main>
        </div>

        <!-- ================================
             PANTALLA DE C√ìDIGO DE CAJA
             ================================ -->
        <div id="checkoutScreen" class="screen">
            <header class="app-header">
                <button id="closeCheckoutBtn" class="btn-back">‚Üê Volver</button>
                <h1 class="header-title">üè™ Ir a Caja</h1>
            </header>

            <main class="screen-content checkout-content">
                <!-- QR Scanner -->
                <div class="checkout-section">
                    <h2 class="section-title">Escanear QR de Caja</h2>
                    <button id="scanCheckoutQRBtn" class="btn btn-primary btn-lg">
                        üì∑ Escanear QR
                    </button>
                </div>

                <div class="divider">
                    <span>O</span>
                </div>

                <!-- Manual Code Entry -->
                <div class="checkout-section">
                    <h2 class="section-title">C√≥digo Manual de Caja</h2>
                    <p class="section-description">Introduce el c√≥digo de 6 n√∫meros</p>
                    <div class="code-input-container">
                        <input 
                            type="text" 
                            id="checkoutCodeInput" 
                            class="checkout-code-input" 
                            placeholder="000000"
                            maxlength="6"
                            inputmode="numeric"
                            pattern="[0-9]*"
                            autocomplete="off"
                        >
                    </div>
                    <button id="submitCheckoutCodeBtn" class="btn btn-primary btn-lg" disabled>
                        Confirmar Compra
                    </button>
                </div>

                <!-- Camera Preview for QR -->
                <div id="checkoutCameraContainer" class="camera-container" style="display: none;">
                    <video id="checkoutCameraPreview" class="camera-preview" autoplay playsinline></video>
                    <div class="scan-overlay">
                        <div class="qr-frame"></div>
                        <p class="scan-instruction">Enfoca el c√≥digo QR de la caja</p>
                    </div>
                    <button id="closeCheckoutCamera" class="btn btn-secondary">Cancelar</button>
                </div>
            </main>
        </div>

        <!-- ================================
             FOOTER DE NAVEGACI√ìN
             ================================ -->
        <nav class="bottom-nav">
            <button id="navSearch" class="nav-item">
                <span class="nav-icon">üîç</span>
                <span class="nav-label">Buscar</span>
            </button>
            <button id="navCheckout" class="nav-item nav-checkout">
                <span class="nav-icon">üè™</span>
                <span class="nav-label">Caja</span>
            </button>
            <button id="navScan" class="nav-item active">
                <span class="nav-icon">üì∑</span>
                <span class="nav-label">Escanear</span>
            </button>
        </nav>

    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/scanner.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>

    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('Service Worker registrado:', registration))
                    .catch(error => console.error('Error al registrar Service Worker:', error));
            });
        }
    </script>
</body>
</html>
